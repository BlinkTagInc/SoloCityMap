<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Solo map</title>
  </head>
  <body>
<style type="text/css">
      #map-canvas {
        height: 500px;
        width: 600px;
      }
</style>
<script type="text/javascript"
  src="https://maps.google.com/maps/api/js?sensor=false"></script>
<!-- stamen maps library -->
<script type="text/javascript" src="http://maps.stamen.com/js/tile.stamen.js?v1.1.3"></script>
<script type="text/javascript">
  var kelurahansFusionTableID = "1jdxsdPlAvCNRair4uv2pOwWTzMNtutDdhfXlp9QO";
  var colors = ['#FF0000', '#00FF00', '#0000FF', '#FFFF00'];
  var map;
  var kelurahans = [];
      function initialize() {
        var stamen_layer = "terrain"; // Kind of Stamen map to be rendered
        var myOptions = {
          zoom: 13,
          center: new google.maps.LatLng(-7.562951899239144, 110.82495983431636),
          mapTypeId: stamen_layer,
          disableDefaultUI: true,
          scaleControl: true, 
          mapTypeControlOptions: {
            mapTypeIds: [stamen_layer]
          }
        };
        map = new google.maps.Map(document.getElementById('map-canvas'),
            myOptions);
        getKelurahans();
      }

      function getKelurahans(){
        var script = document.createElement('script');
        var url = ['https://www.googleapis.com/fusiontables/v1/query?'];
        url.push('sql=');
        var query = 'SELECT KELURAHAN, geometry FROM ' +
            kelurahansFusionTableID;
        var encodedQuery = encodeURIComponent(query);
        url.push(encodedQuery);
        url.push('&callback=parseKelurahans');
        url.push('&key=AIzaSyAm9yWCV7JPCTHCJut8whOjARd7pwROFDQ');
        script.src = url.join('');
        var body = document.getElementsByTagName('body')[0];
        body.appendChild(script);
      }

      function parseKelurahans(data){
        var rows = data['rows'];
        for (var i in rows) {
          var newCoordinates = [];
          var kelurahan_name = rows[i][0];
          //alert(kelurahan_name);
          var geometries = rows[i][1]['geometries'];
          if (geometries) {
            for (var j in geometries) {
              newCoordinates.push(constructNewCoordinates(geometries[j]));
            }
          } else {
            newCoordinates = constructNewCoordinates(rows[i][1]['geometry']);
          }
          kelurahans[i] = new kelurahan(kelurahan_name, newCoordinates, i);
        }
        drawKelurahans(kelurahans);
      }

      function kelurahan(name, geometry, index) {
        this.name = name;
        this.geometry = geometry;
        this.index = index;
        var projects = null;
        this.showProjects = function() {
          if (!projects){
            this.projects = getProjects(name);
          }
          showProjectsOnMap(this.projects)
        }
      }

      function drawKelurahans(kelurahans){
        this.kelurahans = kelurahans;
        shuffleArray = [];
        for (var i=0; i < kelurahans.length; i++){
          shuffleArray[i] = i;
        }
        shuffleArray = shuffle(shuffleArray);
        i = 0;
        var interval = setInterval(function(){
          if (i < kelurahans.length){
            drawKelurahan(kelurahans[shuffleArray[i]]);
            i++;
          } else{
            clearInterval(interval);
          }
        }, 50)

        // for (var i=0; i < kelurahans.length; i++){
        //   drawKelurahan(kelurahans[i]);
        // }

      }


      function drawKelurahan(kelurahan){
        var randomnumber = Math.floor(Math.random() * 4);
        kelurahanShape = new google.maps.Polygon({
          paths: kelurahan.geometry,
          strokeColor: "#000000",
          strokeOpacity: 0.6,
          strokeWeight: 2,
          fillColor: colors[randomnumber],
          fillOpacity: 0.3,
          kelurahan_name : kelurahan.name,
          index : kelurahan.index
        });
        google.maps.event.addListener(kelurahanShape, 'mouseover', function() {
          this.setOptions({fillOpacity: 1});
          document.getElementById("kelurahan_name").innerHTML = this["kelurahan_name"];
        });
        google.maps.event.addListener(kelurahanShape, 'mouseout', function() {
          this.setOptions({fillOpacity: 0.3});
          document.getElementById("kelurahan_name").innerHTML = "";
        });
        google.maps.event.addListener(kelurahanShape, 'click', function() {
          this.setOptions({fillOpacity: 0.1});
        });
        kelurahanShape.setMap(map);          
      }

      function showProjectsOnMap(projects){

      }

      function getProjects(kelurahan_name){
        var projects
        return projects
      }

      function drawMap(data) {

      }

      function constructNewCoordinates(polygon) {
        var newCoordinates = [];
        var coordinates = polygon['coordinates'][0];
        for (var i in coordinates) {
          newCoordinates.push(
              new google.maps.LatLng(coordinates[i][1], coordinates[i][0]));
        }
        return newCoordinates;
      }

      // Fisherâ€“Yates shuffle
      function shuffle(array) {
          var counter = array.length, temp, index;
          // While there are elements in the array
          while (counter > 0) {
              // Pick a random index
              index = Math.floor(Math.random() * counter);
              // Decrease counter by 1
              counter--;
              // And swap the last element with it
              temp = array[counter];
              array[counter] = array[index];
              array[index] = temp;
          }
          return array;
      }




      google.maps.event.addDomListener(window, 'load', initialize);
    </script>
  <body>
    <div id="map-canvas"></div>
    <div>Kelurahan: <p id="kelurahan_name"></p></div>
  </body>
</html>